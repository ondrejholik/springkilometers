{{ template "header.html" .}}
{{ if eq .message ""}}
{{else}}
<div class="notification is-success">
    {{.message}}
</div>
{{end}}
<div class="column is-half  is-offset-one-quarter ">
    <h1 class="title is-1">{{.payload.Name}}
        <span class="tag is-primary is-medium">{{.payload.Km}} km</span>
        {{ if .payload.Withbike }}
        <span class="tag is-info is-medium"><i class="fas fa-bicycle"></i></span>
        {{end}}
    </h1>

    <figure class="image is-4by3">
        <img src="{{.payload.Large}}" alt="Placeholder image">
    </figure>
    <div class="level has-text-centered">
        <div class="level-item has-text-centered">
            <div class="level-item has-text-centered">
                <span class="tag is-primary is-light is-large">
                    <i class="fas fa-calendar"></i>
                    <time class="ml-1"
                        datetime="{{.payload.Year}}-{{.payload.Month}}-{{.payload.Day}}">{{.payload.Day}}. {{.payload.Month}}. {{.payload.Year}}</time>
                </span>
            </div>
            <div class="level-item has-text-centered ml-3">
                <span class="level-item tag  is-primary is-light is-large">
                    <i class="fas fa-clock"></i>
                    <time class="ml-1">{{printf "%02d" .payload.Hour }}:{{printf "%02d" .payload.Minute }}</time>
                </span>
            </div>
        </div>
    </div>
    <h1 class="title is-4 mt-4">Content</h1>
    <p class="content block is-medium has-text-justified">{{.payload.Content}}</p>
    
    <h1 class="title is-4 mt-4">Attended</h1>
    <div class="tags">
        {{range .payload.Users}}
        <a href="/u/view/{{.ID}}"><span class="tag is-warning is-light is-large mr-2">{{.Username}}</span></a>
        {{end}}
    </div>
    
    {{ if eq .payload.Gpx ""}}
    {{else}}
    <h1 class="title is-4 mt-4">Route</h1>
    <div id="map" class="box" style="height:350px"></div>
    {{end}}

    {{ if .is_logged_in}}
    {{if not .isjoined}}
    <form action="/trip/join/{{.payload.ID}}" method="post">
        <button class="button is-success" type="submit" name="join" value="Join" href="">Join</button>
    </form>
    {{else}}
    <form action="/trip/disjoin/{{.payload.ID}}" method="post">
        <button class="button is-danger" type="submit" name="join" value="DisJoin">DisJoin</button>
    </form>
    {{end}}
    {{end}}


</div>

</section>


{{ if eq .payload.Gpx ""}}
{{else}}
<script type="text/javascript" src="https://api.mapy.cz/loader.js"></script>
<script type="text/javascript">Loader.load();</script>
<script type="text/javascript">
 //var center = SMap.Coords.fromWGS84(14.41790, 50.12655);
 var m = new SMap(JAK.gel("map"));
 m.addControl(new SMap.Control.Sync()); /* Aby mapa reagovala na změnu velikosti průhledu */
 m.addDefaultLayer(SMap.DEF_TURIST).enable(); /* Turistický podklad */
 
 var mouse = new SMap.Control.Mouse(SMap.MOUSE_PAN | SMap.MOUSE_WHEEL | SMap.MOUSE_ZOOM); /* Ovládání myší */
 m.addControl(mouse);
 
 var xhr = new JAK.Request(JAK.Request.XML);
 xhr.setCallback(window, "response");
 xhr.send("{{.payload.Gpx}}");
 
 var response = function(xmlDoc) {
     var gpx = new SMap.Layer.GPX(xmlDoc, null, {maxPoints: 10000});
     m.addLayer(gpx);
     gpx.enable();
     gpx.fit();
    } 
</script>
{{end}}

{{ template "footer.html" .}}